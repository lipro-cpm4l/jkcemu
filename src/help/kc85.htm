<html>
<body>
 <h1>Hinweise zur Emulation des HC900 und KC85/2...5</h1>
  Die Computer HC900, KC85/2, KC85/3 und KC85/4 wurden im
  VEB Mikroelektronik M&uuml;hlhausen hergestellt.
  Beim KC85/2 handelt es sich eigentlich nur um einen umbenannten HC900.
  Da aber im Laufe der Zeit das Betriebssystem weiterentwickelt wurde,
  enthielten die als KC85/2 produzierten Ger&auml;te
  meistens eine neuere Betriebssystemversion, n&auml;mlich
  CAOS&nbsp;2.2 anstelle von HC900-CAOS.
  Aus diesem Grund werden beide Ger&auml;te auch als
  separate Systeme emuliert.
 <br/><br/>
  Der KC85/3 ist ein um zus&auml;tzlichen ROM erweiterter KC85/2.
  Neben der neuen Betriebssystemversion CAOS&nbsp;3.1 ist der im ROM
  enthaltene BASIC-Interpreter das Hauptunterscheidungsmerkmal.
 <br/><br/>
  Eine wirkliche Weiterentwicklung in der Hardware ist der KC85/4.
  RAM und ROM wurden vergr&ouml;&szlig;ert und die Video-Hardware
  &uuml;berarbeitet.
  Letzteres f&uuml;hrte in Verbindung mit der wiederum neuen
  Betriebssystemversion CAOS&nbsp;4.x zu einer deutlichen Steigerung
  der Grafik-Performance.
 <br/><br/>
  Den KC85/5 hat es dagegen nie offiziell gegeben.
  Die Leiterplatte des KC85/4 ist bereits f&uuml;r Speicherschaltkreise
  mit einer gr&ouml;&szlig;eren Kapazit&auml;t ausgelegt.
  Unter einem KC85/5 versteht man deshalb einen KC85/4 mit auf
  320&nbsp;KByte (256&nbsp;+&nbsp;64) ausgebautem RAM
  und 48&nbsp;KByte ROM sowie einer neuen Betriebssystemversion,
  die diesen zus&auml;tzlichen Speicher verwalten kann.
 <br/><br/>
  <ul>
   <li><a href="kc85.htm#hardware">1. Emulierte Hardware</a></li>
   <li>
    &nbsp;&nbsp;
    <a href="kc85.htm#keyboard">1.1. Tastatur</a>
   </li>
   <li>
    &nbsp;&nbsp;&nbsp;&nbsp;
    <a href="kc85.htm#key_ctrl">1.1.1. Ctrl-A...Z, ESC und TAB direkt in den Tastaturpuffer</a>
   </li>
   <li>
    &nbsp;&nbsp;
    <a href="kc85.htm#modules">1.2. Module</a>
   </li>
   <li>
    &nbsp;&nbsp;
    <a href="kc85.htm#printer">1.3. Drucker</a>
   </li>
   <li>
    &nbsp;&nbsp;
    <a href="kc85.htm#sound">1.4. Tongeneratoren und Kassettenrecorderanschluss</a>
   </li>
   <li>
    &nbsp;&nbsp;
    <a href="kc85.htm#d004">1.5. Diskettenerweiterung D004</a>
   </li>
   <li><a href="kc85.htm#software">2. Im ROM enthaltene Software</a></li>
   <li><a href="kc85.htm#etc">3. Sonstiges</a></li>
   <li>
    &nbsp;&nbsp;
    <a href="kc85.htm#basic_save">3.1. Speichern eines BASIC-Programms</a>
   </li>
   <li>
    &nbsp;&nbsp;
    <a href="kc85.htm#paste">3.2. Einf&uuml;gen von Text aus der Zwischenablage</a>
   </li>
   <li>
    &nbsp;&nbsp;
    <a href="kc85.htm#video_timing">3.3. Zeitverhalten der Bildschirmsteuerung</a>
   </li>
   <li>
    &nbsp;&nbsp;
    <a href="kc85.htm#d004memerror">3.4. Vermeintlicher D004-Speicherfehler</a>
   </li>
  </ul>
 <br/>

 <h2><a name="hardware">1. Emulierte Hardware</a></h2>
  Emuliert werden die Grundger&auml;te sowie optional die
  <a href="disk/floppydiskintro.htm">Disketten</a>-Erweiterung
  <a href="kc85.htm#d004">D004</a> inkl. der Festplattenerweiterung
  <a href="gide.htm">GIDE</a>
  und einige <a href="kc85.htm#modules">Module</a>.
 <br/><br/>
  Der emulierte Speicher betr&auml;gt bei:
  <ul>
   <li>
    HC900, KC85/2:<br/>
    <ul>
     <li>4&nbsp;KByte ROM</li>
     <li>32&nbsp;KByte RAM inklusive Bildwiederholspeicher</li>
    </ul>
   </li>
   <li>
    KC85/3:<br/>
    <ul>
     <li>16&nbsp;KByte&nbsp;ROM</li>
     <li>32&nbsp;KByte&nbsp;RAM inklusive Bildwiederholspeicher</li>
    </ul>
   </li>
   <li>
    KC85/4:<br/>
    <ul>
     <li>20&nbsp;KByte&nbsp;ROM</li>
     <li>128&nbsp;KByte&nbsp;RAM inklusive Bildwiederholspeicher</li>
    </ul>
   </li>
   <li>
    KC85/5:<br/>
    <ul>
     <li>48&nbsp;KByte&nbsp;ROM</li>
     <li>320&nbsp;KByte&nbsp;RAM inklusive Bildwiederholspeicher</li>
    </ul>
   </li>
  </ul>
 <br/>

 <h3><a name="keyboard">1.1. Tastatur</a></h3>
  Die KC85-Tastatur enth&auml;lt in der oberen Reihe einige Tasten,
  f&uuml;r die es &uuml;blicherweise keine gleichnamigen Tasten
  auf der Tastatur des Emulatorrechners gibt.
  Die Tabelle zeigt das Mapping der Tasten in der oberen Tastaturreihe:
 <br/>
  <table border="1">
   <tr>
    <th>KC85-Taste</th>
    <th>JKCEMU-Taste</th>
    <th>Tastencode</th>
    <th>Bedeutung bei Shift</th>
    <th>Tastencode bei Shift</th>
   </tr>
   <tr>
    <td>Cursor links</td>
    <td>Cursor links</td>
    <td>08h</td>
    <td>CCR</td>
    <td>19h</td>
   </tr>
   <tr>
    <td>Cursor rechts</td>
    <td>Cursor rechts</td>
    <td>09h</td>
    <td>CEL</td>
    <td>18h</td>
   </tr>
   <tr>
    <td>Cursor nach unten</td>
    <td>Cursor nach unten</td>
    <td>0Ah</td>
    <td>SCROL</td>
    <td>12h</td>
   </tr>
   <tr>
    <td>Cursor nach oben</td>
    <td>Cursor nach oben</td>
    <td>0Bh</td>
    <td>PAGE</td>
    <td>11h</td>
   </tr>
   <tr><td>F1</td><td>F1</td><td>0F1h</td><td>F7</td><td>0F7h</td></tr>
   <tr><td>F2</td><td>F2</td><td>0F2h</td><td>F8</td><td>0F8h</td></tr>
   <tr><td>F3</td><td>F3</td><td>0F3h</td><td>F9</td><td>0F9h</td></tr>
   <tr><td>F4</td><td>F4</td><td>0F4h</td><td>FA</td><td>0FAh</td></tr>
   <tr><td>F5</td><td>F5</td><td>0F5h</td><td>FB</td><td>0FBh</td></tr>
   <tr><td>F6</td><td>F6</td><td>0F6h</td><td>FC</td><td>0FCh</td></tr>
   <tr><td>CLR</td><td>F7</td><td>01h</td><td>HCOPY</td><td>0Fh</td></tr>
   <tr><td>STOP</td><td>F8</td><td>13h</td><td>ESC</td><td>1Bh</td></tr>
   <tr><td>BRK</td><td>F9</td><td>03h</td><td></td><td></td></tr>
   <tr><td>INS</td><td>Einfg</td><td>1Ah</td><td>CLICK</td><td>14h</td></tr>
   <tr><td>DEL</td><td>Entf</td><td>1Fh</td><td></td><td></td></tr>
   <tr>
    <td>HOME</td>
    <td>HOME bzw. Pos1</td>
    <td>10h</td>
    <td>CLS</td>
    <td>0Ch</td>
   </tr>
  </table>
 <br/><br/>

 <h3>
  <a name="key_ctrl">1.1.1. Ctrl-A...Z, ESC und TAB direkt in den Tastaturpuffer</a>
 </h3>
  Auf der originalen Tastatur gibt es keine Control-Taste,
  was bei Verwendung eines CP/M-kompatiblen Betriebssystems
  recht hinderlich ist.
  Zwar l&auml;sst sich das Problem durch Verwendung
  spezieller Tasten und Tastenkombinationen teilweise umgehen,
  allerdings nicht vollst&auml;ndig und dann auch nur auf eine
  ziemlich umst&auml;ndliche Art und Weise.
  Eine komfortable L&ouml;sung bietet JKCEMU mit der Option
  <em>Ctrl-A...Z, ESC und TAB direkt in den Tastaturpuffer</em>.
  Damit sind solche Tastatureingaben m&ouml;glich.
  Technisch wird das Problem der fehlenden Control-Taste in der Form
  gel&ouml;st, indem die entsprechenden Codes unter Umgehung der
  emulierten Tastatur direkt in den Tastaturpuffer geschrieben werden.
 <br/><br/>

 <h3><a name="modules">1.2. Module</a></h3>
  Folgende Module werden optional emuliert:
  <table border="1">
   <tr><th>Modul</th><th>Bemerkung</th></tr>
   <tr>
    <td valign="top">M003</td>
    <td>V.24-Modul mit einem an Kanal A angeschlossenen Drucker</td>
   </tr>
   <tr>
    <td valign="top">M006</td>
    <td>
     BASIC-Modul f&uuml;r HC900 und KC85/2,<br/>
     F&uuml;r KC85/3..5 steht das Modul nicht zur Verf&uuml;gung.
    </td>
   </tr>
   <tr><td>M008</td><td>Joystick</td></tr>
   <tr><td>M011</td><td>64&nbsp;KByte RAM</td></tr>
   <tr><td>M012</td><td>TEXOR</td></tr>
   <tr>
     <td>M021</td>
     <td>Joystick / Centronics mit angeschlossenem Drucker</td>
   </tr>
   <tr><td>M022</td><td>16&nbsp;KByte Expander RAM</td></tr>
   <tr><td>M025</td><td>8&nbsp;KByte User PROM</td></tr>
   <tr><td>M026</td><td>Forth</td></tr>
   <tr><td>M027</td><td>Development</td></tr>
   <tr><td>M028</td><td>16&nbsp;KByte User PROM</td></tr>
   <tr><td>M032</td><td>256&nbsp;KByte Segmented RAM</td></tr>
   <tr><td>M033</td><td>TypeStar</td></tr>
   <tr><td>M034</td><td>512&nbsp;KByte Segmented RAM</td></tr>
   <tr><td>M035</td><td>1&nbsp;MByte Segmented RAM</td></tr>
   <tr><td>M035x4</td><td>4&nbsp;MByte Segmented RAM</td></tr>
   <tr><td>M036</td><td>128&nbsp;KByte Segmented RAM</td></tr>
  </table>
 <br/>
  Bei den User-PROM-Modulen M025 und M028 m&uuml;ssen Sie eine ROM-Datei
  angeben, die den Inhalt des Moduls enth&auml;lt.
 <br/><br/>

 <h3><a name="printer">1.3. Drucker</a></h3>
  Mit dem V.24-Modul M003 wird auch ein Drucker emuliert.
  Alle &uuml;ber Kanal A dieses Moduls ausgegebenen Bytes
  werden an den aktiven Druckauftrag angeh&auml;ngt
  (siehe <a href="print.htm#jobs">Drucken und Druckauftr&auml;ge</a>).
  Schalten Sie dazu in den <a href="settings.htm">Einstellungen</a>
  die Emulation des Moduls M003 ein.
  Nun m&uuml;ssen Sie noch die datentechnische Verbindung vom
  Betriebssystem zum Modul herstellen.
  Das erledigt ein entsprechender Treiber.
  Beim KC85/4 und KC85/5 ist ein Treiber f&uuml;r das Modul M003
  bereits im Betriebssystem enthalten.
  Starten Sie diesen mit dem Befehl <em>V24OUT</em> (CAOS&nbsp;4.2)
  bzw. <em>LSTDEV</em> (CAOS&nbsp;4.5).
  F&uuml;r die anderen KC85-Systeme m&uuml;ssen Sie selbst
  einen geeigneten Treiber bereitstellen.
 <br/><br/>
  Eine weitere M&ouml;glichkeit zum Drucken besteht mit dem Modul M021,
  bei dem eine Centronics-Schnittstelle mit angeschlossenem Drucker
  emuliert wird.
  Im CAOS&nbsp;4.5 ist auch daf&uuml;r ein Treiber enthalten:
  F&uuml;hren Sie <em>LSTDEV&nbsp;0</em> aus.
  Bei den anderen CAOS-Versionen m&uuml;ssen Sie wieder selbst
  einen passenden Treiber bereitstellen.
 <br/><br/>

 <h3><a name="sound">1.4. Tongeneratoren und Kassettenrecorderanschluss</a></h3>
  Welche erzeugten T&ouml;ne vom Emulator ausgegeben werden,
  legen Sie durch Auswahl einer entsprechenden Funktion in dem Fenster
  <a href="audio.htm">Audio/Kassette</a> fest. Bei der Funktion
  <a href="audio.htm#sound_out">T&ouml;ne ausgeben (Emulation des Lautsprechers)</a>
  h&ouml;ren Sie das Mischsignal aus beiden Tongeneratoren,
  welches auch der Lautst&auml;rkebeeinflussung unterliegt.
  Bei allen anderen Audio-Funktionen wird das Signal des Tongenerators 1
  (linker Kanal) ohne Lautst&auml;rkebeeinflussung ausgegeben,
  d.h. das Signal, mit dem Dateien auf Kassette gespeichert werden.
 <br/><br/>

 <h3><a name="d004">1.5. Diskettenerweiterung D004</a></h3>
  Die Diskettenerweiterung D004 ist ein Aufsatzger&auml;t,
  welches ein ROM-Modul (ansprechbar &uuml;ber Modulsteckplatz&nbsp;FC)
  und ein eigenes Prozessorsystem enth&auml;lt.
 <br/><br/>
  Den ROM-Inhalt des ROM-Moduls k&ouml;nnen Sie in den
  <a href="settings.htm">Einstellungen</a> frei w&auml;hlen.
  Zur Auswahl stehen die originale ROM-Version&nbsp;2.0 von Robotron und
  die sp&auml;ter von Mario Leubner weiterentwickelten
  Version&nenbsp;3.2 oder&nbsp;3.3,
  oder Sie binden eine externe ROM-Datei ein.
  Standardm&auml;&szlig;ig wird folgende ROM-Version verwendet:
 <br/>
  <table border="1">
   <tr><th>Emuliertes System</th><th>D004-ROM</th></tr>
   <tr>
    <td valign="top">HC900<br/>KC85/2<br/>KC85/3<br/>KC85/4</td>
    <td valign="top">Version&nbsp;2.0</td>
   </tr>
   <tr>
    <td valign="top">KC85/5</td>
    <td valign="top">Version&nbsp;3.3</td>
   </tr>
  </table>
 <br/>
  Einige in JKCEMU integrierten Werkzeuge sind auch mit dem D004-eigenen
  Prozessorsystem benutzbar.
  Beim Aufruf des Debuggers, Reassemblers und Speichereditors
  werden Sie gefragt, ob Sie auf das Hauptprozessorsystem
  (das im Grundger&auml;t) oder auf das D004-Prozessorsystem
  zugreifen m&ouml;chten.
  Es ist auch m&ouml;glich, ein Werkzeug zweimal zu &ouml;ffnen,
  einmal f&uuml;r das Hauptprozessor- und einmal f&uuml;r das D004-System.
 <br/><br/>
  <b>Achtung!</b> Das D004-Prozessorsystem ist vom Hauptprozessorsystem
  aus steuerbar.
  So kann es z.B. auch zur&uuml;ckgesetzt (RESET) oder komplett deaktiviert
  (Dauer-RESET) werden.
  Wenn Sie den Debugger f&uuml;r das D004-Prozessorsystem ge&ouml;ffnet
  und dort die Programmausf&uuml;hrung angehalten haben (z.B. Haltepunkt),
  kann es trotzdem vorkommen,
  dass das Hauptprozessorsystem die D004 zur&uuml;cksetzt oder gar
  deaktiviert.
  Um das zu verhindern, sollten Sie evtl. auch das Hauptprozessorsystem
  anhalten, z.B. im Hauptfenster mit dem Men&uuml;punkt
  <em>Datei</em> &rarr; <em>Pause</em>.
 <br/><br/>


 <h2><a name="software">2. Im ROM enthaltene Software</a></h2>
  <table border="1">
   <tr><th>System/Modul</th><th>Software</th></tr>
   <tr><td valign="top">HC900</td><td>HC900-CAOS</td></tr>
   <tr><td valign="top">KC85/2</td><td>HC-CAOS&nbsp;2.2</td></tr>
   <tr>
    <td valign="top">KC85/3</td>
    <td>HC-CAOS&nbsp;3.1<br/>HC-BASIC</td>
   </tr>
   <tr>
    <td valign="top">KC85/4</td>
    <td>KC-CAOS&nbsp;4.2<br/>HC-BASIC</td>
   </tr>
   <tr>
    <td valign="top">KC85/5</td>
    <td>
     KC-CAOS&nbsp;4.5<br/>
     HC-BASIC<br/>
     EDAS&nbsp;1.6b<br/>
     KC-DEBUGGER&nbsp;1.0<br/>
     KC-FORTH&nbsp;3.1
    </td>
   </tr>
   <tr>
    <td valign="top">M006</td>
    <td>HC901-CAOS<br/>HC-BASIC</td>
   </tr>
   <tr>
    <td valign="top">D004</td>
    <td>je nach Einstellung Version&nbsp;2.0, 3.2 oder&nbsp;3.3</td>
   </tr>
  </table>
 <br/>


 <h2><a name="etc">3. Sonstiges</a></h2>

 <h3><a name="basic_save">3.1. Speichern eines BASIC-Programms</a></h3>
  JKCEMU bietet eine spezielle Unterst&uuml;tzung f&uuml;r das
  <a href="loadsavebasic.htm">Speichern und Laden von BASIC-Programmen</a>.
  Wird ein System mit im ROM enthaltenen BASIC-Interpreter emuliert,
  d.h. ein HC900 bzw. KC85/2 mit aktiviertem BASIC-Modul M006
  oder ein KC85/3...5,
  dann sucht JKCEMU das BASIC-Programm im Adressbereich
  des ROM-BASIC-Interpreters (ab Adresse 0401h).
  Bei einem HC900 bzw. KC85/2 ohne BASIC-Modul wird dagegen
  das BASIC-Programm gespeichert,
  das im Adressbereich des RAM-BASIC-Interpreters liegt (ab Adresse 2C01h).
 <br/><br/>

 <h3>
  <a name="paste">3.2. Einf&uuml;gen von Text aus der Zwischenablage</a>
 </h3>
  Das Einf&uuml;gen von Text aus der Zwichenablage erfolgt gew&ouml;hnlich
  in der Form, dass f&uuml;r jedes einzuf&uuml;gende Zeichen
  das Dr&uuml;cken der entsprechenden Taste bzw. Tastenkombination
  simuliert wird. Dieses Prinzip ist recht langsam.
  F&uuml;r HC900 und KC85/2..5 gibt es in den
  <a href="settings.htm">Einstellungen</a> die Option
  <em>Einf&uuml;gen von Text direkt in den Tastaturpuffer</em>.
  Bei dieser Option werden die einzuf&uuml;genden Zeichen
  direkt in den Tastaturpuffer geschrieben.
  Das ist wesentlich schneller, da dadurch das Dr&uuml;cken der
  entsprechenden Tasten nicht simuliert werden muss.
 <br/><br/>
  Sollten Sie jedoch ein anderes als das in JKCEMU integrierte
  Betriebssystem verwenden,
  wird diese Option m&ouml;glicherweise nicht mehr funktionieren,
  da dort die Tastaturabfrage anders gestaltet sein kann.
  In dem Fall m&uuml;ssen Sie die Option ausschalten.
 <br/><br/>

 <h3>
  <a name="video_timing">3.3. Zeitverhalten der Bildschirmsteuerung</a>
 </h3>
  An den Eing&auml;ngen des Z&auml;hler-/Zeitgeberbausteins (CTC)
  liegen der Bildsynchronimpuls und der doppelte Zeilensynchronimpuls an.
  Dadurch ist es m&ouml;glich, Software zu schreiben,
  die mit der Ausgabe der einzelnen Pixelzeilen auf dem Bildschirm
  synchron l&auml;uft.
  Manche Programmierer nutzen diese M&ouml;glichkeit aus,
  um spezielle Effekte zu erzeugen (z.B. Farbscrolling, siehe Spiel DIGGER).
  Damit solche Effekte auch im Emulator zu sehen sind,
  muss die Visualisierung mit dem Zeitregime an den CTC-Eing&auml;ngen
  synchron emuliert werden.
  Und genau das macht die Option
  <em>Zeitverhalten der Bildschirmsteuerung emulieren</em>.
 <br/><br/>
  Diese zeitsynchrone Emulation ist allerdings sehr rechenintensiv.
  Au&szlig;erdem gibt es auch nur sehr wenige Programme,
  die diese M&ouml;glichkeit nutzen.
  Aus diesem Grund ist die zeitsynchrone Emulation zwischen
  Bildschirmausgabe und CTC in Form einer Option ein- und ausschaltbar.
 <br/><br/>

 <h3><a name="d004memerror">3.4. Vermeintlicher D004-Speicherfehler</a></h3>
  In den D004-ROM-Versionen&nbsp;3.2 und&nbsp;3.3 (Standard bei KC85/5)
  ist ein Speichertest enthalten,
  den Sie mit <tt>JUMP&nbsp;FC&nbsp;FF</tt> aufrufen k&ouml;nnen.
  Es kann vorkommen, dass dieser Speichertest in JKCEMU einen Fehler meldet.
  Die Ursache liegt dabei nicht etwa in einer fehlerhaften Speicherzelle,
  sondern in einem Timeout, der bedingt durch die Art und Weise
  der Emulation auftreten kann.
 <br/><br/>
  In JKCEMU werden die beiden Mikroprozessorsysteme
  (Grundger&auml;t und D004) in separaten Threads emuliert.
  Da der Emulator keinen Einfluss darauf hat,
  wann das Betriebssystem welchen Thread zum Zuge kommen l&auml;sst,
  kann die Emulation der beiden Mikroprozessoren zueinander zeitlich
  wesentlich weiter auseinander liegen als bei einem
  realen KC85/D004-Gespann.
  Die Fehlermeldung erscheint nun deshalb, weil vom Grundger&auml;t aus
  die Adresse der zu pr&uuml;fende Speicherzelle an die D004
  &uuml;bergeben wird.
  In der D004 wird nun die Speicherzelle getestet und das Ergebnis
  an das Grundger&auml;t zur&uuml;ckgemeldet.
  Das Grundger&auml;t wartet nur eine bestimmt Zeit auf die R&uuml;ckmeldung.
  Ist diese Zeit abgelaufen, wird die Speicherzelle als fehlerhaft angesehen
  und somit ein Fehler ausgegeben.
  Wenn nun zuf&auml;llig der D004-Thread zeitlich etwas behindert wurde,
  und deshalb in der D004 der Speichertest vielleicht noch gar nicht
  begonnen hat, wird auch die R&uuml;ckmeldung zu sp&auml;lt erfolgen
  und somit zu einer Fehlermeldung f&uuml;hren.
</body>
</html>
